---
layout: base
title: lenorix vCard
---

<!-- Aspect ratio must be 1.586 -->
<main id="vcard" class="w-96 h-56 border border-gray rounded-xl shadow-2xl m-auto relative p-2
  transition-transform transform
  hover:scale-110
  portrait:rotate-90 portrait:mt-40 mt-20
  grid grid-cols-2 gap-2 grid-rows-9"
  style="background-image: url({{ "/assets/img/vcard-background.svg?v=" | append: site.github.build_revision | relative_url }}); background-size: cover;">

  <h1 class="logo-font text-xl col-span-2">lenorix</h1>

  <img id="vcard-qr" alt="QR code to scan contact vCard" class="row-span-8 mt-1 rounded-sm" />

  <label for="firstname">Firstname:</label>
  <input type="text" id="vcard-firstname" name="firstname" required>
  <label for="surname">Surname:</label>
  <input type="text" id="vcard-surname" name="surname" required>

  <label for="email">Email:</label>
  <input type="email" id="vcard-email" name="email" required>
  <label for="phone">Phone:</label>
  <input type="tel" id="vcard-phone" name="phone" required>
</main>

<script type="text/javascript" defer>
  function vcard(firstname, surname, company, website, email, phone) {
    let vcard = "BEGIN:VCARD\n" +
      "VERSION:4.0\n" +
      "FN:" + firstname + " " + surname + "\n" +
      "N:" + surname + ";" + firstname + ";;;\n";
    
    if (company) vcard += "ORG:" + company + "\n";
    if (website) vcard += "URL:" + website + "\n";
    if (email) vcard += "EMAIL;TYPE=work:" + email + "\n";
    if (phone) vcard += "TEL;TYPE=work:" + phone + "\n";

    vcard += "END:VCARD\n";
    return vcard;
  }

  function updateQRCode(size) {
    let firstname = document.getElementById("vcard-firstname").value;
    let surname = document.getElementById("vcard-surname").value;
    let website = "{{ site.url }}";
    let email = document.getElementById("vcard-email").value;
    let phone = document.getElementById("vcard-phone").value;

    let vcardData = vcard(firstname, surname, "", website, email, phone);
    let vcardUrl = encodeURIComponent(vcardData);

    if (!size) size = 175;
    document.getElementById("vcard-qr").src = `https://api.qrserver.com/v1/create-qr-code/?format=svg&qzone=4&size=${size}x${size}&data=${vcardUrl}`;
  }

  function saveToLocalStorage(field) {
    const value = document.getElementById(field).value;
    localStorage.setItem(field, value);
  }

  function loadFromLocalStorage(field) {
    const value = localStorage.getItem(field);
    if (value) {
      document.getElementById(field).value = value;
    }
  }

  window.addEventListener("load", () => {
    document.querySelectorAll("#vcard input").forEach(input => {
      input.addEventListener("input", () => {
        saveToLocalStorage(input.id);
        updateQRCode();
      });
      loadFromLocalStorage(input.id);
    });
    updateQRCode();
  });
</script>
